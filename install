#!/bin/bash
set -e

. config

mkdir -p $HOST_OUT
mkdir -p $SHARED_OUT

cd core-setup
cd resources
cp -v LICENSE.txt ThirdPartyNotices.txt $OUT_ROOT
cd ..
cd src/corehost/cli
cp -v exe/dotnet $OUT_ROOT
cp -v exe/dotnet $SHARED_OUT
cp -v exe/dotnet $SHARED_OUT/corehost
cp -v dll/libhostpolicy.so $SHARED_OUT
cp -v fxr/libhostfxr.so $HOST_OUT
cp -v fxr/libhostfxr.so $SHARED_OUT
cd ../../..
cd ..

cd coreclr
cd bin/Product/$OS_NAME.$ARCH.$BUILD_CONFIG
cp -v libclrjit.so libcoreclr.so libdbgshim.so libmscordaccore.so libmscordbi.so libsosplugin.so libsos.so mscorlib.dll sosdocsunix.txt $SHARED_OUT
cd ../../..
cd ..

cd corefx
cd bin/$OS_NAME.$ARCH.$BUILD_CONFIG
cp -v Native/*.a Native/*.so $SHARED_OUT
ls | xargs -I % find %/%.dll | xargs -I % cp -v % $SHARED_OUT
cd ..
cd Unix.$ARCH.$BUILD_CONFIG
ls | xargs -I % find %/%.dll | xargs -I % cp -v % $SHARED_OUT
cd ..
cd AnyOS.$ARCH.$BUILD_CONFIG
ls | xargs -I % find %/%.dll | xargs -I % cp -v % $SHARED_OUT
cd ..
cd ..
cd ..

cd cli
#./build.sh
#cd bin
#cp
#cd ..
cd ..

cd libuv
cp -v .libs/libuv.so $SHARED_OUT
cd ..
